<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>כסף חכם</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400..700;1,400..700&family=Assistant:wght@200..800&family=Inter:wght@100..900&display=swap" rel="stylesheet">

    <style>
        /* Custom CSS for Glassmorphism and other styles */
        body {
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background-color 0.3s ease;
        }
        .dark { color-scheme: dark; }
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #1f2937;
            transition: color 0.3s ease;
        }
        .dark .app-container { color: #d1d5db; }
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .transparent-mode .main-content { background-color: rgba(255, 255, 255, 0.1); }
        .dark.transparent-mode .main-content { background-color: rgba(0, 0, 0, 0.2); }

        .glass-card, .glass-button, .glass-button-sm, .glass-button-google, .glass-icon-button, .glass-input {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease-in-out;
        }
        .dark .glass-card, .dark .glass-button, .dark .glass-button-sm, .dark .glass-button-google, .dark .glass-icon-button, .dark .glass-input {
            background: rgba(31, 41, 55, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-card { padding: 1.5rem; }
        .glass-button { padding: 0.75rem 1.5rem; font-weight: bold; }
        .glass-button-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }
        .glass-icon-button { padding: 0.75rem; display: flex; align-items: center; justify-content: center; }
        .glass-button-google { padding: 0.75rem 1.5rem; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        .glass-button:hover, .glass-button-sm:hover, .glass-icon-button:hover, .glass-button-google:hover { background: rgba(255, 255, 255, 0.4); }
        .dark .glass-button:hover, .dark .glass-button-sm:hover, .dark .glass-icon-button:hover, .dark .glass-button-google:hover { background: rgba(31, 41, 55, 0.5); }
        .glass-input { padding: 0.75rem; color: inherit; background-color: transparent; width: 100%; }
        .glass-input::placeholder { color: #6b7280; }
        .dark .glass-input::placeholder { color: #9ca3af; }
        .glass-input:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.7);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down { animation: fade-in-down 0.5s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        
        window.firebaseSDK = {
            initializeApp, getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword,
            signInWithEmailAndPassword, signOut, onAuthStateChanged, getFirestore, doc, setDoc,
            onSnapshot, collection, addDoc, deleteDoc
        };
    </script>

    <!-- React App -->
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // SVG Icons as React Components
        const BellIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path></svg>;
        const SettingsIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>;
        const GlobeIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>;
        const LogoutIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>;
        const XIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const Trash2Icon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const CheckCircleIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;

        const translations = {
            he: { appName: "כסף חכם", allRightsReserved: "© 2025 כל הזכויות שמורות", close: "סגור", save: "שמור", savedSuccessfully: "ההגדרות נשמרו בהצלחה", errorSaving: "שגיאה בשמירת ההגדרות", description: "תיאור", amount: "סכום", date: "תאריך", add: "הוסף", cancel: "ביטול", login: "התחברות", signup: "הרשמה", loginWithGoogle: "התחברות עם גוגל", continueAsGuest: "המשך כאורח", logout: "התנתקות", email: "אימייל", password: "סיסמה", confirmPassword: "אימות סיסמה", username: "שם משתמש", passwordsDoNotMatch: "הסיסמאות אינן תואמות", dashboard: "לוח מחוונים", totalBalance: "יתרה כוללת", income: "הכנסה", expense: "הוצאה", addTransaction: "הוסף עסקה", recentTransactions: "עסקאות אחרונות", savingsGoals: "יעדי חיסכון", settings: "הגדרות", displaySettings: "הגדרות תצוגה", theme: "ערכת נושא", light: "בהיר", dark: "כהה", transparent: "שקוף", backgroundImage: "תמונת רקע", imageUrl: "כתובת URL של תמונה", uploadFromComputer: "העלה מהמחשב", font: "גופן", language: "שפה", currency: "מטבע", tipSettings: "הגדרות טיפים", showTips: "הצג טיפים", tipWelcome: "ברוכים הבאים! מומלץ לבקר בהגדרות העיצוב כדי להתאים אישית את המראה.", tipLogin: "מומלץ להתחבר! כל הנתונים שלך יישמרו ותוכל לגשת אליהם מכל מכשיר.", tipBackground: "רוצה לשנות רקע? בהגדרות עיצוב תוכל להדביק קישור לתמונה או להעלות אחת מהמחשב.", tipTransparent: "הפעלת מצב שקוף עם תמונת רקע יוצרת אפקט מדהים!", addSavingsGoal: "הוסף יעד חיסכון", goalName: "שם היעד", targetAmount: "סכום יעד", currentAmount: "סכום נוכחי", targetDate: "תאריך יעד", notificationCenter: "מרכז התראות", noNotifications: "אין התראות חדשות.", },
            en: { appName: "Smart Money", allRightsReserved: "© 2025 All Rights Reserved", close: "Close", save: "Save", savedSuccessfully: "Settings saved successfully", errorSaving: "Error saving settings", description: "Description", amount: "Amount", date: "Date", add: "Add", cancel: "Cancel", login: "Login", signup: "Sign Up", loginWithGoogle: "Login with Google", continueAsGuest: "Continue as Guest", logout: "Logout", email: "Email", password: "Password", confirmPassword: "Confirm Password", username: "Username", passwordsDoNotMatch: "Passwords do not match", dashboard: "Dashboard", totalBalance: "Total Balance", income: "Income", expense: "Expense", addTransaction: "Add Transaction", recentTransactions: "Recent Transactions", savingsGoals: "Savings Goals", settings: "Settings", displaySettings: "Display Settings", theme: "Theme", light: "Light", dark: "Dark", transparent: "Transparent", backgroundImage: "Background Image", imageUrl: "Image URL", uploadFromComputer: "Upload from Computer", font: "Font", language: "Language", currency: "Currency", tipSettings: "Tip Settings", showTips: "Show Tips", tipWelcome: "Welcome! We recommend visiting the display settings to customize your experience.", tipLogin: "Consider signing in! All your data will be saved and accessible from any device.", tipBackground: "Want a new background? In display settings, you can paste an image URL or upload from your computer.", tipTransparent: "Enable transparent mode with a background image for a stunning effect!", addSavingsGoal: "Add Savings Goal", goalName: "Goal Name", targetAmount: "Target Amount", currentAmount: "Current Amount", targetDate: "Target Date", notificationCenter: "Notification Center", noNotifications: "No new notifications.", },
        };
        const currencies = [ { code: 'ILS', symbol: '₪' }, { code: 'USD', symbol: '$' }, { code: 'EUR', symbol: '€' }, { code: 'GBP', symbol: '£' }, { code: 'JPY', symbol: '¥' }, { code: 'CAD', symbol: 'C$' }, { code: 'AUD', symbol: 'A$' }, { code: 'CHF', symbol: 'CHF' }, { code: 'CNY', symbol: '¥' }, { code: 'CZK', symbol: 'Kč' }, { code: 'INR', symbol: '₹' }, { code: 'RUB', symbol: '₽' }, ];
        const languages = [{ code: 'he', name: 'עברית' }, { code: 'en', name: 'English' }];
        const fonts = [ { name: 'Inter', value: '"Inter", sans-serif' }, { name: 'Arimo', value: '"Arimo", sans-serif' }, { name: 'Assistant', value: '"Assistant", sans-serif' }, ];

        const Toast = ({ message, type, onClose }) => {
            useEffect(() => { const timer = setTimeout(onClose, 5000); return () => clearTimeout(timer); }, [onClose]);
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            return ( <div className={`fixed top-5 left-5 text-white p-4 rounded-lg shadow-lg z-[100] ${bgColor} animate-fade-in-down`}> <div className="flex items-center"> <CheckCircleIcon /> <span className="mr-2">{message}</span> <button onClick={onClose} className="ml-4 text-xl">&times;</button> </div> </div> );
        };

        const Tip = ({ message, onClose }) => {
            useEffect(() => { const timer = setTimeout(onClose, 25000); return () => clearTimeout(timer); }, [onClose]);
            return ( <div className="fixed top-5 right-5 bg-blue-500 text-white p-3 rounded-lg shadow-lg z-[100] max-w-xs animate-fade-in-down"> <div className="flex items-center"> <span className="flex-grow">{message}</span> <button onClick={onClose} className="ml-2 text-lg">&times;</button> </div> </div> );
        };

        const Modal = ({ children, isOpen, onClose, title }) => {
            if (!isOpen) return null;
            return ( <div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 transition-opacity" onClick={onClose}> <div className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl rounded-2xl shadow-2xl p-6 w-full max-w-md m-4 text-gray-800 dark:text-gray-200" onClick={e => e.stopPropagation()}> <div className="flex justify-between items-center border-b border-gray-300 dark:border-gray-600 pb-3 mb-4"> <h2 className="text-2xl font-bold">{title}</h2> <button onClick={onClose} className="text-gray-500 hover:text-gray-800 dark:hover:text-gray-200"><XIcon /></button> </div> <div className="max-h-[70vh] overflow-y-auto pr-2">{children}</div> </div> </div> );
        };

        function App() {
            const [sdkReady, setSdkReady] = useState(false);
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [isGuest, setIsGuest] = useState(false);
            const [settings, setSettings] = useState({ theme: 'light', isTransparent: false, backgroundImage: '', font: '"Inter", sans-serif', language: 'he', currency: 'ILS', showTips: true });
            const [transactions, setTransactions] = useState([]);
            const [savingsGoals, setSavingsGoals] = useState([]);
            const [activeModal, setActiveModal] = useState(null);
            const [toast, setToast] = useState(null);
            const [currentTip, setCurrentTip] = useState(null);
            const [tipsQueue, setTipsQueue] = useState([]);

            // Firebase SDKs
            const [firebase, setFirebase] = useState(null);

            useEffect(() => {
                const interval = setInterval(() => {
                    if (window.firebaseSDK) {
                        clearInterval(interval);
                        const firebaseConfig = { apiKey: "AIzaSyCAkTramEw9xQsKDJafmKPTRaoQMyxl_88", authDomain: "my-money-site-177b1.firebaseapp.com", projectId: "my-money-site-177b1", storageBucket: "my-money-site-177b1.firebasestorage.app", messagingSenderId: "1001673216101", appId: "1:1001673216101:web:1135329ea119260a89b68c" };
                        const app = window.firebaseSDK.initializeApp(firebaseConfig);
                        const auth = window.firebaseSDK.getAuth(app);
                        const db = window.firebaseSDK.getFirestore(app);
                        const googleProvider = new window.firebaseSDK.GoogleAuthProvider();
                        setFirebase({ app, auth, db, googleProvider, ...window.firebaseSDK });
                        setSdkReady(true);
                    }
                }, 100);
            }, []);

            useEffect(() => {
                if (!sdkReady) return;
                const unsubscribe = firebase.onAuthStateChanged(firebase.auth, (currentUser) => {
                    setUser(currentUser);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [sdkReady]);

            const t = useCallback((key) => translations[settings.language]?.[key] || translations['en'][key], [settings.language]);

            useEffect(() => {
                if (user) {
                    setIsGuest(false);
                    const unsub = firebase.onSnapshot(firebase.doc(firebase.db, 'users', user.uid), (docSnap) => {
                        if (docSnap.exists() && docSnap.data().settings) setSettings(prev => ({ ...prev, ...docSnap.data().settings }));
                    });
                    const transUnsub = firebase.onSnapshot(firebase.collection(firebase.db, 'users', user.uid, 'transactions'), (snapshot) => { setTransactions(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))); });
                    const goalsUnsub = firebase.onSnapshot(firebase.collection(firebase.db, 'users', user.uid, 'savingsGoals'), (snapshot) => { setSavingsGoals(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }))); });
                    return () => { unsub(); transUnsub(); goalsUnsub(); };
                } else { setTransactions([]); setSavingsGoals([]); }
            }, [user, sdkReady]);
            
            useEffect(() => {
                document.documentElement.lang = settings.language;
                document.documentElement.dir = settings.language === 'he' ? 'rtl' : 'ltr';
                document.body.className = settings.theme === 'dark' ? 'dark' : '';
                document.body.style.fontFamily = settings.font;
                document.body.style.backgroundImage = settings.backgroundImage ? `url(${settings.backgroundImage})` : 'none';
            }, [settings]);

            useEffect(() => {
                if (settings.showTips) {
                    const tipsToShow = [t('tipWelcome'), t('tipBackground'), t('tipTransparent')];
                    if (!user && !isGuest) tipsToShow.push(t('tipLogin'));
                    setTipsQueue(tipsToShow);
                } else { setTipsQueue([]); setCurrentTip(null); }
            }, [settings.showTips, user, isGuest, t]);

            useEffect(() => {
                if (tipsQueue.length > 0 && !currentTip) {
                    const nextTip = tipsQueue[0];
                    setCurrentTip(nextTip);
                    setTipsQueue(q => q.slice(1));
                }
            }, [tipsQueue, currentTip]);

            const { totalBalance, currencySymbol } = useMemo(() => {
                const balance = transactions.reduce((acc, t) => t.type === 'income' ? acc + t.amount : acc - t.amount, 0);
                const symbol = currencies.find(c => c.code === settings.currency)?.symbol || '₪';
                return { totalBalance: balance, currencySymbol: symbol };
            }, [transactions, settings.currency]);

            const showToast = (message, type) => setToast({ message, type });
            const handleLogout = async () => { await firebase.signOut(firebase.auth); setIsGuest(false); };
            const handleGoogleSignIn = async () => { try { await firebase.signInWithPopup(firebase.auth, firebase.googleProvider); } catch (err) { console.error(err.message); } };
            const addTransaction = async (tx) => { if (user) { await firebase.addDoc(firebase.collection(firebase.db, 'users', user.uid, 'transactions'), tx); } else if (isGuest) { setTransactions(prev => [...prev, { ...tx, id: Date.now().toString() }].sort((a,b) => new Date(b.date) - new Date(a.date))); } };
            const addSavingsGoal = async (goal) => { if (user) { await firebase.addDoc(firebase.collection(firebase.db, 'users', user.uid, 'savingsGoals'), goal); } else if (isGuest) { setSavingsGoals(prev => [...prev, { ...goal, id: Date.now().toString() }]); } };
            const deleteGoal = async (goalId) => { if (user) { await firebase.deleteDoc(firebase.doc(firebase.db, 'users', user.uid, 'savingsGoals', goalId)); } else if (isGuest) { setSavingsGoals(prev => prev.filter(g => g.id !== goalId)); } };
            const saveSettings = async (newSettings) => { setSettings(newSettings); if (user) { try { await firebase.setDoc(firebase.doc(firebase.db, 'users', user.uid), { settings: newSettings }, { merge: true }); showToast(t('savedSuccessfully'), 'success'); } catch (error) { showToast(t('errorSaving'), 'error'); } } setActiveModal(null); };

            if (loading || !sdkReady) return <div className="h-screen w-screen flex justify-center items-center text-xl">טוען...</div>;

            return (
                <div className={`app-container ${settings.isTransparent ? 'transparent-mode' : ''}`}>
                    <div className="main-content">
                        <Header t={t} user={user} isGuest={isGuest} setActiveModal={setActiveModal} handleLogout={handleLogout} handleGoogleSignIn={handleGoogleSignIn} />
                        <main className="p-4">
                            {(user || isGuest) ? <Dashboard t={t} totalBalance={totalBalance} currencySymbol={currencySymbol} transactions={transactions} savingsGoals={savingsGoals} setActiveModal={setActiveModal} deleteGoal={deleteGoal} /> : <WelcomeScreen t={t} setActiveModal={setActiveModal} setIsGuest={setIsGuest} handleGoogleSignIn={handleGoogleSignIn} />}
                        </main>
                        <footer className="text-center p-4 mt-auto text-sm text-gray-500 dark:text-gray-400">{t('allRightsReserved')}</footer>
                    </div>
                    <AuthModal isOpen={activeModal === 'auth'} onClose={() => setActiveModal(null)} t={t} firebase={firebase} />
                    <SettingsModal isOpen={activeModal === 'settings'} onClose={() => setActiveModal(null)} t={t} currentSettings={settings} onSave={saveSettings} />
                    <AddTransactionModal isOpen={activeModal === 'addTransaction'} onClose={() => setActiveModal(null)} t={t} onAdd={addTransaction} currencySymbol={currencySymbol} />
                    <SavingsGoalModal isOpen={activeModal === 'addSavingsGoal'} onClose={() => setActiveModal(null)} t={t} onAdd={addSavingsGoal} />
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    {currentTip && <Tip message={currentTip} onClose={() => setCurrentTip(null)} />}
                </div>
            );
        }

        const Header = ({ t, user, isGuest, setActiveModal, handleLogout, handleGoogleSignIn }) => (
            <header className="p-4 flex justify-between items-center text-inherit">
                <h1 className="text-2xl md:text-3xl font-bold">{t('appName')}</h1>
                <div className="flex items-center space-x-2 md:space-x-4">
                    {(user || isGuest) ? (
                        <><button onClick={() => setActiveModal('notifications')} className="glass-icon-button"><BellIcon /></button><button onClick={() => setActiveModal('settings')} className="glass-icon-button"><SettingsIcon /></button><button onClick={() => setActiveModal('language')} className="glass-icon-button"><GlobeIcon /></button>{user && <button onClick={handleLogout} className="glass-icon-button"><LogoutIcon /></button>}</>
                    ) : (
                        <div className="flex flex-col items-end space-y-1"><button onClick={() => setActiveModal('auth')} className="glass-button-sm">{t('login')}</button><button onClick={handleGoogleSignIn} className="glass-button-sm">{t('loginWithGoogle')}</button></div>
                    )}
                </div>
            </header>
        );

        const WelcomeScreen = ({ t, setActiveModal, setIsGuest, handleGoogleSignIn }) => (
            <div className="text-center p-10 glass-card max-w-2xl mx-auto">
                <h2 className="text-4xl font-bold mb-4">ברוכים הבאים ל-{t('appName')}</h2>
                <p className="text-lg mb-8">מנהל הכספים האישי שלך. התחבר כדי לשמור את הנתונים, או המשך כאורח כדי להתנסות.</p>
                <div className="flex flex-col sm:flex-row justify-center gap-4">
                    <button onClick={() => setActiveModal('auth')} className="glass-button">{t('login')} / {t('signup')}</button>
                    <button onClick={handleGoogleSignIn} className="glass-button-google">{t('loginWithGoogle')}</button>
                    <button onClick={() => setIsGuest(true)} className="glass-button">{t('continueAsGuest')}</button>
                </div>
            </div>
        );

        const Dashboard = ({ t, totalBalance, currencySymbol, transactions, savingsGoals, setActiveModal, deleteGoal }) => (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div className="glass-card col-span-1 md:col-span-2 lg:col-span-3"><h2 className="text-xl font-bold mb-2">{t('totalBalance')}</h2><p className="text-4xl font-bold">{currencySymbol}{totalBalance.toFixed(2)}</p><button onClick={() => setActiveModal('addTransaction')} className="glass-button mt-4">{t('addTransaction')}</button></div>
                <div className="glass-card md:col-span-2"><h2 className="text-xl font-bold mb-4">{t('recentTransactions')}</h2><ul className="space-y-3">{transactions.slice(0, 5).map(tx => (<li key={tx.id} className="flex justify-between items-center"><div><p className="font-semibold">{tx.description}</p><p className="text-sm text-gray-500 dark:text-gray-400">{new Date(tx.date).toLocaleDateString()}</p></div><p className={`font-bold ${tx.type === 'income' ? 'text-green-500' : 'text-red-500'}`}>{tx.type === 'income' ? '+' : '-'}{currencySymbol}{tx.amount.toFixed(2)}</p></li>))}</ul></div>
                <div className="glass-card"><h2 className="text-xl font-bold mb-4">{t('savingsGoals')}</h2><div className="space-y-4">{savingsGoals.map(goal => (<div key={goal.id}><div className="flex justify-between items-center mb-1"><span className="font-semibold">{goal.name}</span><span className="text-sm font-bold">{currencySymbol}{goal.targetAmount}</span></div><div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"><div className="bg-blue-500 h-4 rounded-full" style={{ width: `${(goal.currentAmount / goal.targetAmount) * 100}%` }}></div></div><div className="text-right text-xs mt-1">{currencySymbol}{goal.currentAmount} / {currencySymbol}{goal.targetAmount}<button onClick={() => deleteGoal(goal.id)} className="mr-2 text-red-500"><Trash2Icon /></button></div></div>))}</div><button onClick={() => setActiveModal('addSavingsGoal')} className="glass-button-sm mt-4 w-full">{t('addSavingsGoal')}</button></div>
            </div>
        );

        const AuthModal = ({ isOpen, onClose, t, firebase }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [confirmPassword, setConfirmPassword] = useState('');
            const [username, setUsername] = useState('');
            const [error, setError] = useState('');
            const handleAuthAction = async (e) => { e.preventDefault(); setError(''); if (!isLogin && password !== confirmPassword) { setError(t('passwordsDoNotMatch')); return; } try { if (isLogin) { await firebase.signInWithEmailAndPassword(firebase.auth, email, password); } else { const cred = await firebase.createUserWithEmailAndPassword(firebase.auth, email, password); await firebase.setDoc(firebase.doc(firebase.db, 'users', cred.user.uid), { username, email }); } onClose(); } catch (err) { setError(err.message); } };
            return ( <Modal isOpen={isOpen} onClose={onClose} title={isLogin ? t('login') : t('signup')}> <form onSubmit={handleAuthAction} className="space-y-4"> {error && <p className="bg-red-200 text-red-800 p-3 rounded-md">{error}</p>} {!isLogin && <input type="text" value={username} onChange={e => setUsername(e.target.value)} placeholder={t('username')} className="glass-input" required />} <input type="email" value={email} onChange={e => setEmail(e.target.value)} placeholder={t('email')} className="glass-input" required /> <input type="password" value={password} onChange={e => setPassword(e.target.value)} placeholder={t('password')} className="glass-input" required /> {!isLogin && <input type="password" value={confirmPassword} onChange={e => setConfirmPassword(e.target.value)} placeholder={t('confirmPassword')} className="glass-input" required />} <button type="submit" className="glass-button w-full">{isLogin ? t('login') : t('signup')}</button> </form> <button onClick={() => setIsLogin(!isLogin)} className="text-blue-500 hover:underline mt-4 text-center w-full">{isLogin ? "צריך חשבון? הירשם" : "כבר יש לך חשבון? התחבר"}</button> </Modal> );
        };

        const SettingsModal = ({ isOpen, onClose, t, currentSettings, onSave }) => {
            const [settings, setSettings] = useState(currentSettings);
            useEffect(() => setSettings(currentSettings), [currentSettings, isOpen]);
            const handleChange = (key, value) => setSettings(prev => ({ ...prev, [key]: value }));
            const handleFileChange = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onloadend = () => handleChange('backgroundImage', reader.result); reader.readAsDataURL(file); } };
            return ( <Modal isOpen={isOpen} onClose={onClose} title={t('settings')}> <div className="space-y-6"> <section> <h3 className="text-xl font-semibold mb-3">{t('displaySettings')}</h3> <div className="space-y-4"> <div> <label className="font-bold">{t('theme')}</label> <div className="flex space-x-2 mt-2"> <button onClick={() => handleChange('theme', 'light')} className={`px-4 py-2 rounded-lg ${settings.theme === 'light' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}`}>{t('light')}</button> <button onClick={() => handleChange('theme', 'dark')} className={`px-4 py-2 rounded-lg ${settings.theme === 'dark' ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}`}>{t('dark')}</button> </div> </div> <div className="flex items-center"><input type="checkbox" id="transparent" checked={settings.isTransparent} onChange={e => handleChange('isTransparent', e.target.checked)} className="ml-2" /><label htmlFor="transparent">{t('transparent')}</label></div> <div> <label htmlFor="backgroundImage" className="font-bold">{t('backgroundImage')}</label> <input type="text" value={settings.backgroundImage} onChange={e => handleChange('backgroundImage', e.target.value)} placeholder={t('imageUrl')} className="glass-input w-full mt-1" /> <label htmlFor="fileUpload" className="glass-button-sm mt-2 inline-block cursor-pointer">{t('uploadFromComputer')}</label> <input type="file" id="fileUpload" onChange={handleFileChange} className="hidden" accept="image/*" /> </div> <div> <label htmlFor="font" className="font-bold">{t('font')}</label> <select value={settings.font} onChange={e => handleChange('font', e.target.value)} className="glass-input w-full mt-1">{fonts.map(f => <option key={f.name} value={f.value}>{f.name}</option>)}</select> </div> </div> </section> <div className="pt-4 border-t border-gray-300 dark:border-gray-600"> <button onClick={() => onSave(settings)} className="glass-button w-full">{t('save')}</button> </div> </div> </Modal> );
        };
        
        const AddTransactionModal = ({ isOpen, onClose, t, onAdd, currencySymbol }) => {
            const [type, setType] = useState('expense'); const [description, setDescription] = useState(''); const [amount, setAmount] = useState(''); const [date, setDate] = useState(new Date().toISOString().slice(0, 10));
            const handleSubmit = (e) => { e.preventDefault(); onAdd({ type, description, amount: parseFloat(amount), date }); onClose(); setDescription(''); setAmount(''); };
            return ( <Modal isOpen={isOpen} onClose={onClose} title={t('addTransaction')}> <form onSubmit={handleSubmit} className="space-y-4"> <div className="flex space-x-2"> <button type="button" onClick={() => setType('expense')} className={`flex-1 py-2 rounded-lg ${type === 'expense' ? 'bg-red-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}`}>{t('expense')}</button> <button type="button" onClick={() => setType('income')} className={`flex-1 py-2 rounded-lg ${type === 'income' ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}`}>{t('income')}</button> </div> <input type="text" value={description} onChange={e => setDescription(e.target.value)} placeholder={t('description')} className="glass-input" required /> <input type="number" value={amount} onChange={e => setAmount(e.target.value)} placeholder={`${t('amount')} (${currencySymbol})`} className="glass-input" required min="0.01" step="0.01" /> <input type="date" value={date} onChange={e => setDate(e.target.value)} className="glass-input" required /> <div className="flex justify-end space-x-3 pt-4"> <button type="button" onClick={onClose} className="glass-button-sm bg-gray-500">{t('cancel')}</button> <button type="submit" className="glass-button-sm bg-blue-500">{t('add')}</button> </div> </form> </Modal> );
        };

        const SavingsGoalModal = ({ isOpen, onClose, t, onAdd }) => {
            const [name, setName] = useState(''); const [targetAmount, setTargetAmount] = useState(''); const [currentAmount, setCurrentAmount] = useState('0'); const [targetDate, setTargetDate] = useState('');
            const handleSubmit = (e) => { e.preventDefault(); onAdd({ name, targetAmount: parseFloat(targetAmount), currentAmount: parseFloat(currentAmount), targetDate }); onClose(); setName(''); setTargetAmount(''); setCurrentAmount('0'); setTargetDate(''); };
            return ( <Modal isOpen={isOpen} onClose={onClose} title={t('addSavingsGoal')}> <form onSubmit={handleSubmit} className="space-y-4"> <input type="text" value={name} onChange={e => setName(e.target.value)} placeholder={t('goalName')} className="glass-input" required /> <input type="number" value={targetAmount} onChange={e => setTargetAmount(e.target.value)} placeholder={t('targetAmount')} className="glass-input" required min="1" /> <input type="number" value={currentAmount} onChange={e => setCurrentAmount(e.target.value)} placeholder={t('currentAmount')} className="glass-input" required min="0" /> <input type="date" value={targetDate} onChange={e => setTargetDate(e.target.value)} className="glass-input" required /> <div className="flex justify-end space-x-3 pt-4"> <button type="button" onClick={onClose} className="glass-button-sm bg-gray-500">{t('cancel')}</button> <button type="submit" className="glass-button-sm bg-blue-500">{t('save')}</button> </div> </form> </Modal> );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
